---
layout: post
title:  "嵌入式实验1_生产者&消费者"
imges: 
date:   2019-11-13 10:00:00 +0800
description: 请自行复制粘贴运行即可
---


### producer.c 
```
#include <unistd.h>
#include <sys/file.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "lock_set.c"
#define MAXLEN 10
#define ALPHBET 1
#define ALPHBET_START 'a'
#define COUNT_OF_ALPHBET 26

#define DIGIT 2
#define DIGIT_START '0'
#define COUNT_OF_DIGIT 10

#define SIGN_TYPE  ALPHBET 

const char *fifo_file="./myfifo";
char buff[MAXLEN];

int product(void)
{
	int fd;
	unsigned int signtype,signstart,signcount,size;
	static unsigned int counter=0;
	if ((fd=open(fifo_file,O_CREAT|O_RDWR|O_APPEND,0644))<0)
	{
	  printf("Open FIFO File Error\n");
      exit(1);	
	}
	signtype=SIGN_TYPE;
	switch(signtype)
	{
		case ALPHBET:
		{
			signstart=ALPHBET_START;
			signcount=COUNT_OF_ALPHBET;
		}
		break;
		case DIGIT:
		{
			signstart=DIGIT_START;
			signcount=COUNT_OF_DIGIT;
		}
		break;
		default:
		  return -1;		
	}
    sprintf(buff,"%c",(signstart+counter));
    counter=(counter+1)%signcount;
	lock_set(fd,F_WRLCK);
	if ((size=write(fd,buff,strlen(buff)))<0)
	{
	  printf("Producer:write error\n");
      return -1;	
	}
	lock_set(fd,F_UNLCK);
	close(fd);
	return 0;
}

int main(int argc,char *argv[])
{
  int timestep=1;
  int timelife=10;
  if (argc>1)
  {
    sscanf(argv[1],"%d",&timestep);
  }
    if (argc>2)
  {
    sscanf(argv[2],"%d",&timelife);
  }
  while(timelife--)
  {
	if (product()<0) break;
    sleep(timestep);	
  }
  
  exit(0);
}

```
<hr />

